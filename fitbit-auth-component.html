<link rel="import" href="./bower_components/polymer/polymer-element.html">

<dom-module id="fitbit-auth-component">

  <script>
    class FitbitAuthComponent extends Polymer.Element {
      static get is() { return 'fitbit-auth-component'; }
      static get properties() {
        return {
          clientId: String,
          redirectURI: String,
          expiration: {
            type: Number,
            value: 3154000
          }, 
          scope: {
            type: Array,
            value: FitbitAuthComponent.defaultScope()
          }
        };
      }
      static defaultScope() {
        return ['activity', 'heartrate', 'location', 'nutrition', 'profile', 'settings', 'sleep', 'social', 'weight'] 
      }
      authorize() {
        console.log('authorizing...')
        try {
          let path = `https://www.fitbit.com/oauth2/authorize?`
          let params = `response_type=token&client_id=${this.clientId}&redirect_uri=${this.redirectURI}&scope=${encodeURI(this.scope.join(','))}&expires_in=${this.expiration}`
          window.location = path + params;
        } catch(e) {
          console.error('FitbitAuthComponent config error:', e)
        }
      }

      connectedCallback() {
        super.connectedCallback();
        this.authorize();
      }
    }

    window.customElements.define(FitbitAuthComponent.is, FitbitAuthComponent);
  </script>
</dom-module>